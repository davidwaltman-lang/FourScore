<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher's Custom Word Sort</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .panel { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 650px; margin-bottom: 20px; }
        .hidden { display: none !important; }
        
        /* Teacher UI */
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; }
        textarea { width: 100%; height: 60px; margin: 10px 0; padding: 12px; border-radius: 8px; border: 1px solid #ced4da; font-family: inherit; resize: vertical; }
        .cat-row { display: flex; gap: 15px; margin-bottom: 15px; }
        .cat-input { flex: 1; display: flex; flex-direction: column; }
        label { font-weight: bold; font-size: 0.9em; color: #34495e; }
        input[type="text"] { padding: 10px; border-radius: 8px; border: 1px solid #ced4da; margin-top: 5px; }

        /* Game UI */
        .game-area { width: 100%; max-width: 900px; display: flex; flex-direction: column; align-items: center; }
        .word-bank { background: #fff; padding: 20px; border-radius: 12px; min-height: 80px; width: 100%; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; border: 2px dashed #cbd5e0; }
        .category-container { display: flex; gap: 20px; width: 100%; justify-content: center; flex-wrap: wrap; }
        .category { background: #edf2f7; border: 2px solid #3498db; border-radius: 12px; min-height: 250px; width: 300px; padding: 15px; display: flex; flex-direction: column; align-items: center; transition: background 0.2s; }
        .category.drag-over { background: #e2e8f0; border-style: dashed; }
        .word { background: #3498db; color: white; padding: 10px 18px; border-radius: 50px; cursor: grab; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.15); user-select: none; }
        .word.correct { background: #28a745 !important; }
        .word.incorrect { background: #dc3545 !important; }

        .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.2s; }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #28a745; color: white; margin-top: 10px; width: 100%; }
        .btn-check { background: #2c3e50; color: white; }
    </style>
</head>
<body>

    <div id="setupPanel" class="panel">
        <h2>ðŸ›  Teacher Game Creator</h2>
        <p style="font-size: 0.9em; color: #666;">Enter your categories and words (separated by commas). Then copy the link for Google Sites.</p>
        
        <div class="cat-row">
            <div class="cat-input">
                <label>Category A Name:</label>
                <input type="text" id="cat1Name" placeholder="e.g. Nouns">
                <textarea id="cat1Words" placeholder="Apple, Dog, Teacher"></textarea>
            </div>
            <div class="cat-input">
                <label>Category B Name:</label>
                <input type="text" id="cat2Name" placeholder="e.g. Verbs">
                <textarea id="cat2Words" placeholder="Run, Jump, Think"></textarea>
            </div>
        </div>
        
        <button class="btn btn-primary" onclick="previewGame()">Preview Board Below</button>
        <button id="copyBtn" class="btn btn-success" onclick="generateStudentLink()">ðŸ“‹ Copy Student Link for Google Sites</button>
    </div>

    <div id="gamePanel" class="game-area hidden">
        <h2 id="displayTitle">Interactive Word Sort</h2>
        <div class="word-bank" id="wordBank" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div class="category-container" id="categoryContainer"></div>
        <div style="margin-top: 30px; display: flex; gap: 15px;">
            <button class="btn btn-check" onclick="checkAnswers()">Check My Work</button>
            <button class="btn" style="background: #a0aec0; color:white;" onclick="location.reload()">Reset / Clear</button>
        </div>
    </div>

<script>
    // 1. DATA HANDLING & URL LOGIC
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const encodedData = urlParams.get('game');
        
        if (encodedData) {
            try {
                // Decode the data from the URL
                const data = JSON.parse(decodeURIComponent(escape(atob(encodedData))));
                renderGame(data);
                document.getElementById('setupPanel').classList.add('hidden');
                document.getElementById('gamePanel').classList.remove('hidden');
            } catch (e) {
                console.error("Link Error:", e);
                alert("This link appears to be incomplete or broken.");
            }
        }
    }

    function getGameData() {
        return {
            n1: document.getElementById('cat1Name').value || "Category 1",
            n2: document.getElementById('cat2Name').value || "Category 2",
            w1: document.getElementById('cat1Words').value.split(',').map(s => s.trim()).filter(s => s),
            w2: document.getElementById('cat2Words').value.split(',').map(s => s.trim()).filter(s => s)
        };
    }

    function renderGame(data) {
        const bank = document.getElementById('wordBank');
        const container = document.getElementById('categoryContainer');
        bank.innerHTML = ''; container.innerHTML = '';

        [data.n1, data.n2].forEach(name => {
            const div = document.createElement('div');
            div.className = 'category';
            div.setAttribute('data-target', name);
            div.innerHTML = `<h3>${name}</h3>`;
            div.ondrop = drop; 
            div.ondragover = allowDrop;
            div.ondragleave = (e) => e.currentTarget.classList.remove('drag-over');
            container.appendChild(div);
        });

        let mixed = [];
        data.w1.forEach(w => mixed.push({t: w, c: data.n1}));
        data.w2.forEach(w => mixed.push({t: w, c: data.n2}));
        
        mixed.sort(() => Math.random() - 0.5).forEach((item, i) => {
            const div = document.createElement('div');
            div.className = 'word'; div.draggable = true; div.id = 'word'+i;
            div.innerText = item.t; div.dataset.cor = item.c;
            div.addEventListener('dragstart', drag);
            bank.appendChild(div);
        });
    }

    function previewGame() {
        renderGame(getGameData());
        document.getElementById('gamePanel').classList.remove('hidden');
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // 2. THE FIX: ROBUST COPY TO CLIPBOARD
    function generateStudentLink() {
        const data = getGameData();
        const blob = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        const cleanUrl = window.location.origin + window.location.pathname;
        const studentUrl = `${cleanUrl}?game=${blob}`;
        
        // Fallback method using a temporary textarea
        const textArea = document.createElement("textarea");
        textArea.value = studentUrl;
        document.body.appendChild(textArea);
        textArea.select();
        
        let successful = false;
        try {
            successful = document.execCommand('copy');
        } catch (err) {
            successful = false;
        }

        document.body.removeChild(textArea);

        if (successful) {
            finalizeCopy();
        } else {
            alert("Manual Copy Required: Select the text below and copy it manually.\n\n" + studentUrl);
        }
    }

    function finalizeCopy() {
        const btn = document.getElementById('copyBtn');
        const originalText = btn.innerText;
        btn.innerText = "âœ… LINK COPIED!";
        btn.style.backgroundColor = "#2ecc71";
        
        alert("Link Copied! You can now paste this URL into your Google Sites 'Embed' tool.");
        
        setTimeout(() => { 
            btn.innerText = originalText; 
            btn.style.backgroundColor = "#28a745";
        }, 3000);
    }

    // 3. INTERACTIVE LOGIC
    function allowDrop(e) { 
        e.preventDefault(); 
        if(e.currentTarget.classList.contains('category')) e.currentTarget.classList.add('drag-over');
    }
    
    function drag(e) { e.dataTransfer.setData("text", e.target.id); }
    
    function drop(e) {
        e.preventDefault();
        e.currentTarget.classList.remove('drag-over');
        const id = e.dataTransfer.getData("text");
        const draggedElement = document.getElementById(id);
        if (e.currentTarget.classList.contains('category') || e.currentTarget.id === "wordBank") {
            e.currentTarget.appendChild(draggedElement);
        }
    }

    function checkAnswers() {
        document.querySelectorAll('.word').forEach(w => {
            const parent = w.parentElement.getAttribute('data-target');
            if (parent === w.dataset.cor) {
                w.classList.add('correct'); w.classList.remove('incorrect');
            } else if (parent) {
                w.classList.add('incorrect'); w.classList.remove('correct');
            }
        });
    }
</script>
</body>
</html>
