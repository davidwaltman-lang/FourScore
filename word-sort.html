<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Word Sort Generator</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .setup-panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 600px; margin-bottom: 20px; }
        .hidden { display: none !important; }
        
        textarea { width: 100%; height: 80px; margin: 10px 0; padding: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        .category-config { display: flex; gap: 10px; margin-bottom: 10px; }
        input[type="text"] { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }

        /* Game Styles */
        .game-container { display: flex; gap: 20px; width: 100%; max-width: 800px; justify-content: center; flex-wrap: wrap; }
        .category { background: #dfe6e9; border: 2px dashed #b2bec3; border-radius: 12px; min-height: 200px; width: 280px; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .word-bank { background: white; padding: 20px; border-radius: 12px; min-height: 50px; width: 100%; max-width: 760px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; border: 1px solid #ddd; }
        .word { background: #3498db; color: white; padding: 8px 16px; border-radius: 20px; cursor: grab; font-weight: bold; }
        .word.correct { background: #27ae60 !important; }
        .word.incorrect { background: #e74c3c !important; }

        button { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; background: #2d3436; color: white; }
        #share-btn { background: #6c5ce7; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="setupPanel" class="setup-panel">
        <h2>ðŸ›  Teacher Setup</h2>
        <p>1. Name your two categories:</p>
        <div class="category-config">
            <input type="text" id="cat1Name" placeholder="e.g. Living">
            <input type="text" id="cat2Name" placeholder="e.g. Non-Living">
        </div>
        <p>2. Enter words for Category 1 (comma separated):</p>
        <textarea id="cat1Words" placeholder="Bird, Tree, Human"></textarea>
        <p>3. Enter words for Category 2 (comma separated):</p>
        <textarea id="cat2Words" placeholder="Rock, Car, Cloud"></textarea>
        
        <button onclick="launchGame()">Preview Game</button>
        <button id="share-btn" onclick="generateLink()">Copy Student Link</button>
    </div>

    <div id="gamePanel" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <h2 id="gameTitle">Word Sort</h2>
        <div class="word-bank" id="wordBank" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div class="game-container" id="categoryContainer"></div>
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button onclick="checkAnswers()">Check Work</button>
            <button onclick="location.reload()" style="background:#95a5a6;">Reset</button>
        </div>
    </div>

<script>
    // 1. Check if URL has data (Student Mode)
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('data')) {
            const data = JSON.parse(atob(urlParams.get('data')));
            renderGame(data);
            document.getElementById('setupPanel').classList.add('hidden');
            document.getElementById('gamePanel').classList.remove('hidden');
        }
    }

    function launchGame() {
        const data = getFormData();
        renderGame(data);
        document.getElementById('gamePanel').classList.remove('hidden');
    }

    function getFormData() {
        return {
            c1n: document.getElementById('cat1Name').value || "Cat 1",
            c2n: document.getElementById('cat2Name').value || "Cat 2",
            c1w: document.getElementById('cat1Words').value.split(',').map(s => s.trim()),
            c2w: document.getElementById('cat2Words').value.split(',').map(s => s.trim())
        };
    }

    function renderGame(data) {
        const bank = document.getElementById('wordBank');
        const container = document.getElementById('categoryContainer');
        bank.innerHTML = ''; container.innerHTML = '';

        // Create Categories
        [data.c1n, data.c2n].forEach(name => {
            const div = document.createElement('div');
            div.className = 'category';
            div.setAttribute('data-target', name);
            div.innerHTML = `<h3>${name}</h3>`;
            div.ondrop = drop; div.ondragover = allowDrop;
            container.appendChild(div);
        });

        // Create Words
        let allWords = [];
        data.c1w.forEach(w => allWords.push({t: w, c: data.c1n}));
        data.c2w.forEach(w => allWords.push({t: w, c: data.c2n}));
        
        allWords.sort(() => Math.random() - 0.5).forEach((item, i) => {
            const div = document.createElement('div');
            div.className = 'word'; div.draggable = true; div.id = 'w'+i;
            div.innerText = item.t; div.dataset.cor = item.c;
            div.addEventListener('dragstart', drag);
            bank.appendChild(div);
        });
    }

    function generateLink() {
        const data = btoa(JSON.stringify(getFormData()));
        const baseUrl = window.location.href.split('?')[0];
        const fullUrl = `${baseUrl}?data=${data}`;
        navigator.clipboard.writeText(fullUrl);
        alert("Link copied! Give this URL to students or embed it in Google Sites.");
    }

    // Drag/Drop logic same as before
    function allowDrop(e) { e.preventDefault(); }
    function drag(e) { e.dataTransfer.setData("text", e.target.id); }
    function drop(e) {
        e.preventDefault();
        const data = e.dataTransfer.getData("text");
        e.currentTarget.appendChild(document.getElementById(data));
    }

    function checkAnswers() {
        document.querySelectorAll('.word').forEach(w => {
            const p = w.parentElement.getAttribute('data-target');
            if (p === w.dataset.cor) w.classList.add('correct');
            else if (p) w.classList.add('incorrect');
        });
    }
</script>
</body>
</html>
