<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Connections â€“ Print</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 18px; }
  .top { display:flex; justify-content:space-between; align-items:flex-end; gap:16px; flex-wrap:wrap; margin-bottom:12px; }
  .title { font-weight:900; font-size:18px; }
  .meta { display:flex; gap:18px; font-size:12px; }
  .grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; max-width:760px; }
  .cell {
    border:1px solid #000; border-radius:10px; padding:10px; text-align:center;
    font-weight:700; min-height:44px; display:flex; align-items:center; justify-content:center;
  }
  .directions { margin-top:10px; font-size:12px; }
</style>
</head>
<body>

<div class="top">
  <div class="title">Connections</div>
  <div class="meta">
    <div>Name: _________________________</div>
    <div>Period: ______</div>
  </div>
</div>

<div id="grid" class="grid"></div>
<div class="directions">Directions: Find four groups of four.</div>

<script>
  function decodeB64Unicode(b64){
    try { return decodeURIComponent(escape(atob(b64))); } catch(e){ return null; }
  }
  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  const m = (location.hash || "").match(/#p=([^&]+)/);
  if (!m) {
    document.body.innerHTML = "<p>Missing puzzle data.</p>";
    throw "";
  }

  const raw = decodeB64Unicode(m[1]);
  if (!raw) {
    document.body.innerHTML = "<p>Could not read puzzle data.</p>";
    throw "";
  }

  const puzzle = JSON.parse(raw);
  const words = shuffle((puzzle.groups || []).flatMap(g => g.terms || []));

  const grid = document.getElementById("grid");
  words.forEach(w => {
    const d = document.createElement("div");
    d.className = "cell";
    d.textContent = w;
    grid.appendChild(d);
  });

  // Print once the grid is painted
  setTimeout(() => window.print(), 150);
</script>

</body>
</html>
